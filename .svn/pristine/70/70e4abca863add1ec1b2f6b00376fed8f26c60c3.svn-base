<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8" />
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
        <title>Finmart-Dashboard</title>
        <link href="dashboard.css" rel="stylesheet" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
        <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
        <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    </head>

    <body>
        <div class="Leads">
            <div class="contactDetails">
                <h4>My Conatct Details</h4>
                <div class="threeColGrid">
                    <div>
                        <span class="total_count"></span>
                        <img src="Images/contact.png">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width:50%">
                            </div>
                        </div>
                        <span class="txt">Total Contact</span>
                    </div>
                    <div>
                        <span class="NoCount  landmark_count"></span>
                        <img src="Images/link.png">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width:50%">
                            </div>
                        </div>
                        <span class="txt">Landmark Contact</span>
                    </div>
                    <div>
                        <span class="NoCount  landmark_Cust_count"></span>
                        <img src="Images/notepad.png">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width:50%">
                            </div>
                        </div>
                        <span class="txt">Total Policy</span>
                    </div>
                </div>
            </div>
            <div class="renewalReminder">
                <h4>Renewal Reminder</h4>
                <div class="twoColGrid" id="append_month_contact">

                </div>
            </div>
            <div id="contactInfo">
                <!--   <div class="info">
                       <i class="fa fa-times close" aria-hidden="true"></i>
                       <h5>Renewal Reminder - January 2020</h5>
                       <table border="0" cellpadding="0" cellspacing="0" width="100%">
                           <tr>
                               <th>Number</th>
                               <th>Policy No.</th>
                               <th>Renewal Date</th>
                               <th>Share</th>
                               <th>Action</th>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                           <tr>
                               <td>9856235689</td>
                               <td>123456789562</td>
                               <td>12/01/2020</td>
                               <td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>
                               <td><span class="sendbutton">SEND</span></td>
                           </tr>
                       </table>
                       <div class="right">
                           <div class="pagination">
                               <a href="#">&laquo;</a>
                               <a href="#" class="active">1</a>
                               <a href="#">2</a>
                               <a href="#">3</a>
                               <a href="#">&raquo;</a>
                           </div>
                       </div>
                   </div>  -->
            </div>
        </div>
		
		<div class="add_info_section">
			<div class="add_info_content">
			<div class="close_info_popup" onclick="hideInfopopup()">&times;</div>
				<div class="input_box">
					<span class="wrap is-empty">
                        <input id="Reg1" class="inputIsu Reg" type="text" placeholder="MH" maxlength="2" data-tooltip="Please Put Vehicle Number" data-tooltip-animate-function="foldin" data-tooltip-stickto="left" data-tooltip-color="black" autocomplete="nope">
                        <input id="Reg2" class="inputIsu Reg" type="text" placeholder="01" maxlength="2" data-tooltip="Please Put Vehicle Number" data-tooltip-animate-function="foldin" data-tooltip-stickto="left" data-tooltip-color="black" autocomplete="nope">
                        <input id="Reg3" class="inputIsu Reg" type="text" placeholder="AB" maxlength="3" data-tooltip="Please Put Vehicle Number" data-tooltip-animate-function="foldin" data-tooltip-stickto="left" data-tooltip-color="black" autocomplete="nope">
                        <input id="Reg4" class="inputIsu Reg" type="number" maxlength="4" placeholder="1234" pattern="/^-?\d+\.?\d*$/" onkeypress="if(this.value.length==4) return false;" style="width:66px;" data-tooltip="Please Put Vehicle Number" data-tooltip-animate-function="foldin" data-tooltip-stickto="left" data-tooltip-color="black" autocomplete="nope">
                    </span>
					<button class="btn_submit">SUBMIT</button>
					<div class="MMV">
						<p> Make : HONDA</p>
						<p> Model : CITY</p>
						<p> Varient : 1.5 S MT</p>
					</div>
				</div>
			</div>
		</div>

    </body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script>
        var sync_contact;
        var siteURL = "";
        $(document).ready(function () {
            var ss_id = getUrlVars()["ss_id"];
            var fba_id = getUrlVars()["fba_id"];
            if ((ss_id != null && ss_id != "" && ss_id !== undefined) && (fba_id != null && fba_id != "" && fba_id !== undefined)) {
                $.ajax({
                    type: "GET",
                    url: siteURL.indexOf('https://') === 0 ? GeteditUrl() + "/TwoWheelerInsurance/call_horizon_get?method_name=/sync_contacts/sync_contact_dashboard/" + ss_id + "/" + fba_id : GetUrl() + "/sync_contacts/sync_contact_dashboard/" + ss_id + "/" + fba_id,
                    success: function (data) {
                        console.log("sync_contact-", data);
                        sync_contact = data;
                        if (data.hasOwnProperty('Total_Contact_Count')) {
                            $(".total_count").append(data.Total_Contact_Count);
                        } else {
                            $(".total_count").append('0');
                        }
                        if (data.hasOwnProperty('LandMark_Count')) {
                            $(".landmark_count").append(data.LandMark_Count);
                        } else {
                            $(".landmark_count").append('0');
                        }
                        if (data.hasOwnProperty('Landmark_Policy_Count')) {
                            $(".landmark_Cust_count").append(data.Landmark_Policy_Count);
                        } else {
                            $(".landmark_Cust_count").append('0');
                        }
                        if (data.hasOwnProperty('Month_Count')) {
                            for (var i in data.Month_Count) {
                                $("#append_month_contact").append('<div class="month ' + i + '" id="month_popup"><div class="circle">' + data.Month_Count[i].count + '</div>' +
                                        '<p>' + i + '</p>' +
                                        '<img src="Images/calender.png"></div>');
                                $("#contactInfo").append('<div style ="display:none;"  class="info ' + i.split(' ')[0] + '">' +
                                        '<i class="fa fa-times close" aria-hidden="true"></i>' +
                                        '<h5>Renewal Reminder - ' + i + '</h5>' +
                                        '<table border="0" cellpadding="0" cellspacing="0" width="100%" id="tbl_list' + i.split(' ')[0] + '">' +
                                        '</table>' +
                                        '<div class="right">' +
                                        '<div class="pagination">' +
                                        //'<a href="#">&laquo;</a>' +
                                        //'<a href="#" class="active">1</a>' +
                                        //'<a href="#">2</a>' +
                                        //'<a href="#">3</a>' +
                                        //'<a href="#">&raquo;</a>' +
                                        '</div>' +
                                        '</div>' +
                                        '</div>'
                                        );
                                $('.month').click(function (e) {
                                    //$('#contactInfo').show();
                                    var monthpop = $(this).attr("class");
                                    PopupList_Bind(sync_contact, monthpop);
                                    //$('.'+monthpop).show();
                                });
                                $('.close').click(function () {
                                    $('#contactInfo').hide();
                                });
                            }
                        } else {
                            $("#append_month_contact").append('<div class="month" ><div class="circle">' - '</div>' +
                                    '<p>' + i + '</p>' +
                                    '<img src="Images/calender.png"></div>');
                        }

                    },
                    error: function (error) {
                        console.log(error);
                        alert("Oops! Something went wrong.");
                        $(".total_count").append('-');
                        $(".landmark_count").append('-');
                        $(".landmark_Cust_count").append('-');
                        $("#append_month_contact").append('<tr>' +
                                '<td>-</td>' +
                                '<td>-</td>' +
                                '</tr>');

                    }
                });

            } else {
                alert("Please ensure that SS ID & FBA ID is proper");
            }
        });
        function PopupList_Bind(sync_contact, monthpop) {
            var PageCount;
            console.log("sync_contact-" + sync_contact + "monthpop - " + monthpop);
            monthpop = monthpop.split(' ')[1] + ' ' + monthpop.split(' ')[2];
            sync_contact = sync_contact.Month_Count[monthpop];
            $('.info').hide();
            $('.pagination').show();
            $("#tbl_list" + monthpop.split(' ')[0]).empty();
            $("#tbl_list" + monthpop.split(' ')[0]).append('<tr>' +
			        '<th>Customer Name</th>' +
                    //'<th></th>' +
                    '<th>Reg. No.</th>' +
                    '<th>Renewal Date</th>' +
					'<th>Lead Created</th>' +
					'<th></th>' +
                    //'<th>Share</th>' +
                    //'<th>Action</th>' +
                    '</tr>'
                    );
            if (sync_contact) {
                if (sync_contact.count > 0) {
                    PageCount = Math.round(sync_contact.count / 10);

                    if (sync_contact.count <= 10) {
                        $('.pagination').hide();
                    }
                    var datalen = sync_contact.data;
                    for (var z in datalen) {
                        var pol_exp_dt = moment(datalen[z].policy_expiry_date);
                        var curr_dt = moment();
                        var TotalDays = pol_exp_dt.diff(curr_dt, 'days');
                        if ((TotalDays <= 45 && TotalDays >= 0 ) && (pol_exp_dt.format('MM') == curr_dt.format('MM')) ) 
						{
                            $("#tbl_list" + monthpop.split(' ')[0]).append('<tr>' +
							        '<td style="width:34%">' + datalen[z].name +' <div><b>Mobile:</b> ' + datalen[z].mobile +'</div></td>' +
                                    //'<td style="width:26%;padding:6px 10px;text-align:center;">' '</td>' +
                                    '<td style="width:20%;text-align:center;">' + datalen[z].registration_no + ' <button class="add_info" onclick="showInformation()">Add</button></td>' +
                                    '<td style="width:18%;text-align:center;">' + datalen[z].policy_expiry_date + '</td>' +
									'<td style="width:10%;text-align:center;">Yes</td>' +
									'<td style="width:5%;text-align:center;"><i class="fa fa-info-circle" aria-hidden="true"></i></td>' +
                                    //'<td><a href="#"><i class="fa fa-share-alt" aria-hidden="true"></i></a></td>' +
                                    //'<td><span class="sendbutton">SEND</span></td>' +
									
									//'<td style="width:20%">' + datalen[z].policy_expiry_date + '</td>'
									
                                    '</tr>'
                                    );
                        } 
						else {
                            //$(".month").switchClass("month", "month-new");
                        }
                    }
                } else {
                    //$(".month").switchClass("month", "month-new");
                   // $("#tbl_list" + monthpop.split(' ')[0]).append('<tr>' +
                   //        '<td colspan="3" style="text-align: center; vertical-align: middle;"> No Data Avilable</td>' +
                   //         //'<th>Share</th>' +
                   //         //'<th>Action</th>' +
                   //         '</tr>'
                   //         );
                    $('.pagination').hide();
                }
                $('#contactInfo').show();
                $('.' + monthpop.split(' ')[0]).show();
            } else {
                $('#contactInfo').hide();
            }
            var totalRowCount = $("#tbl_list" + monthpop.split(' ')[0]+" tr").length;
            if (totalRowCount<= 1){$('#contactInfo').hide();}
        }
        ;
        function GeteditUrl() {
            var url = window.location.href;
            //alert(url.includes("health"));
            var newurl;
            //newurl = "http://qa.policyboss.com";
            if (url.includes("request_file")) {
                newurl = "http://localhost:50111";
            } else if (url.includes("qa")) {
                newurl = "http://qa.policyboss.com";
            } else if (url.includes("www") || url.includes("cloudfront")) {
                newurl = "https://www.policyboss.com";
            }
            return newurl;
        }

        function GetUrl() {
            var url = window.location.href;
            var newurl;
            if (url.includes("request_file")) {
                newurl = "http://localhost:3000";
            } else if (url.includes("qa")) {
                newurl = "http://qa-horizon.policyboss.com:3000";
            } else if (url.includes("www") || url.includes("cloudfront")|| url.includes("origin-cdnh")) {
                newurl = "http://horizon.policyboss.com:5000";
            }
            return newurl;
        }
        var getUrlVars = function () {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                if (hashes[i].includes("?"))
                {
                    hashes1 = hashes[i].split('?');
                    for (var k in hashes1) {
                        hashes.push(hashes1[k]);
                    }
                }
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
		function showInformation(){
			$('.add_info_section').show();
		}
		function hideInfopopup(){
			$('.add_info_section').hide();
		}
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            //$('.twoColGrid').click(function () {
            //$('#contactInfo').show();
            //});

        });
    </script>

</html>